<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ê°ì½” ì»¤ë®¤ë‹ˆí‹°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* í™”ë©´ ì „í™˜ íš¨ê³¼ */
        .page {
            display: none;
        }
        .page.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2563eb;
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- ì „ì²´ ì»¨í…Œì´ë„ˆ -->
    <div class="container mx-auto p-4 max-w-7xl">

        <!-- í—¤ë” -->
        <header class="flex justify-between items-center py-4 border-b border-gray-200">
            <div class="flex items-center space-x-2 cursor-pointer" onclick="showPage('lobby')">
                <span class="text-2xl font-bold text-blue-600"><i class="fas fa-laptop-code"></i> ëª¨ê°ì½”</span>
            </div>
            <nav class="hidden md:flex items-center space-x-6">
                <a href="#" class="text-gray-600 hover:text-blue-600 font-medium" onclick="showPage('lobby')">ëª¨ê°ì½” ì°¾ê¸°</a>
                <a href="#" class="text-gray-600 hover:text-blue-600 font-medium" onclick="showPage('rankingPage')">ë­í‚¹</a>
                <a href="#" class="text-gray-600 hover:text-blue-600 font-medium" onclick="showPage('myPage')">ë§ˆì´í˜ì´ì§€</a>
                <img src="https://placehold.co/40x40/A3BFFA/FFFFFF?text=P" alt="User Profile" class="w-10 h-10 rounded-full cursor-pointer hover:ring-2 hover:ring-blue-400" onclick="showPage('myPage')">
            </nav>
            <button class="md:hidden text-2xl" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </header>

        <!-- ëª¨ë°”ì¼ ë©”ë‰´ -->
        <div id="mobileMenu" class="hidden md:hidden mt-4 bg-white rounded-lg shadow-md p-4">
            <a href="#" class="block py-2 text-gray-600 hover:text-blue-600" onclick="showPage('lobby'); toggleMobileMenu();">ëª¨ê°ì½” ì°¾ê¸°</a>
            <a href="#" class="block py-2 text-gray-600 hover:text-blue-600" onclick="showPage('rankingPage'); toggleMobileMenu();">ë­í‚¹</a>
            <a href="#" class="block py-2 text-gray-600 hover:text-blue-600" onclick="showPage('myPage'); toggleMobileMenu();">ë§ˆì´í˜ì´ì§€</a>
            <div class="border-t mt-4 pt-4">
                 <div class="flex items-center space-x-3">
                    <img src="https://placehold.co/40x40/A3BFFA/FFFFFF?text=P" alt="User Profile" class="w-10 h-10 rounded-full cursor-pointer" onclick="showPage('myPage'); toggleMobileMenu();">
                    <div>
                        <p class="font-semibold text-gray-800">ì§€ì€</p>
                        <a href="#" class="text-sm text-red-500 hover:underline">ë¡œê·¸ì•„ì›ƒ</a>
                    </div>
                </div>
            </div>
        </div>


        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="mt-8">

            <!-- ë¡œë¹„ í˜ì´ì§€ -->
            <div id="lobby" class="page active">
                <section class="text-center bg-white p-8 rounded-xl shadow-sm">
                    <h1 class="text-4xl font-bold mb-4">í•¨ê»˜í•˜ëŠ” ê¾¸ì¤€í•¨, <span class="text-blue-600">ì„±ì¥ì„ ë§Œë“¤ë‹¤</span></h1>
                    <p class="text-gray-600 max-w-2xl mx-auto mb-8">í˜¼ìì„œëŠ” ì–´ë ¤ìš´ ëª©í‘œ, ëª¨ê°ì½”ì—ì„œ ë™ë£Œë“¤ê³¼ í•¨ê»˜ ì´ë£¨ì–´ë³´ì„¸ìš”. ì§€ê¸ˆ ë°”ë¡œ ì°¸ì—¬í•˜ê³  ì¦‰ì‹œ ëª°ì… í™˜ê²½ì„ ê²½í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <button class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold text-lg hover:bg-blue-700 transition transform hover:scale-105" onclick="openCreateRoomModal()">
                        <i class="fas fa-plus mr-2"></i>ëª¨ê°ì½” ë§Œë“¤ê¸°
                    </button>
                </section>

                <section class="mt-12 p-6 bg-white rounded-xl shadow-sm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                        <div>
                            <label for="searchInput" class="block text-sm font-medium text-gray-700 mb-1">ë°© ì œëª©ìœ¼ë¡œ ê²€ìƒ‰</label>
                            <input type="text" id="searchInput" placeholder="ì•Œê³ ë¦¬ì¦˜, í¬íŠ¸í´ë¦¬ì˜¤..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        </div>
                        <div class="flex items-center space-x-4 md:space-x-6 pt-5">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="micFilter" class="h-5 w-5 rounded text-blue-600 focus:ring-blue-500 border-gray-300">
                                <span class="font-medium text-gray-700"><i class="fas fa-microphone text-gray-500 mr-1"></i>ë§ˆì´í¬</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="camFilter" class="h-5 w-5 rounded text-blue-600 focus:ring-blue-500 border-gray-300">
                                <span class="font-medium text-gray-700"><i class="fas fa-video text-gray-500 mr-1"></i>ìº </span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="screenFilter" class="h-5 w-5 rounded text-blue-600 focus:ring-blue-500 border-gray-300">
                                <span class="font-medium text-gray-700"><i class="fas fa-desktop text-gray-500 mr-1"></i>í™”ë©´ê³µìœ </span>
                            </label>
                        </div>
                    </div>
                </section>

                <section class="mt-8">
                    <h2 class="text-2xl font-bold mb-6">ëª¨ê°ì½” ëª©ë¡ ğŸ“š</h2>
                    <div id="roomList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- JSë¡œ ìŠ¤í„°ë””ë°© ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </section>
            </div>

            <!-- ìŠ¤í„°ë””ë°© í˜ì´ì§€ -->
            <div id="studyRoom" class="page"></div>

            <!-- ë§ˆì´í˜ì´ì§€ -->
            <div id="myPage" class="page"></div>

            <!-- ë­í‚¹ í˜ì´ì§€ -->
            <div id="rankingPage" class="page"></div>
            
            <!-- ì‚¬ìš©ì í”„ë¡œí•„ í˜ì´ì§€ -->
            <div id="userProfilePage" class="page"></div>

        </main>
    </div>

    <!-- ë°© ë§Œë“¤ê¸° ëª¨ë‹¬ -->
    <div id="createRoomModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden overflow-y-auto py-10"></div>
    
    <!-- ë°© ì…ì¥ ëª¨ë‹¬ -->
    <div id="joinRoomModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden"></div>


    <script>
        // --- ì´ˆê¸° ë°ì´í„° (ì„œë²„ ëŒ€ì‹  ì‚¬ìš©) ---
        const mockScreenImages = [
            'https://placehold.co/400x225/2d3748/e2e8f0?text=VS+Code',
            'https://placehold.co/400x225/1a202c/90cdf4?text=Illustrator',
            'https://placehold.co/400x225/4a5568/f7fafc?text=Browser',
            'https://placehold.co/400x225/38a169/f0fff4?text=Algorithm+Site'
        ];

        const allBadges = [
            { id: 'b01', name: 'ê¾¸ì¤€í•¨ì˜ ì¦í‘œ', icon: 'fa-medal', color: 'text-yellow-500', description: '7ì¼ ì—°ì†ìœ¼ë¡œ ìŠ¤í„°ë””ì— ì°¸ì—¬í•˜ì„¸ìš”.' },
            { id: 'b02', name: 'ì§‘ì¤‘ì˜ ë‹¬ì¸', icon: 'fa-star', color: 'text-indigo-500', description: 'ëˆ„ì  50ì‹œê°„ ì´ìƒ ê³µë¶€í•˜ì„¸ìš”.' },
            { id: 'b03', name: 'ìµœê³ ì˜ ë™ë£Œ', icon: 'fa-users', color: 'text-teal-500', description: '5ê°œ ì´ìƒì˜ ìŠ¤í„°ë””ì— ì°¸ì—¬í•˜ì„¸ìš”.' },
            { id: 'b04', name: 'ì–¼ë¦¬ë²„ë“œ', icon: 'fa-sun', color: 'text-orange-400', description: 'ì˜¤ì „ 6ì‹œ ~ 9ì‹œ ì‚¬ì´ì— 5íšŒ ì´ìƒ ì°¸ì—¬í•˜ì„¸ìš”.' },
            { id: 'b05', name: 'ë‚˜ì´íŠ¸ ì•„ìš¸', icon: 'fa-moon', color: 'text-purple-500', description: 'ì˜¤í›„ 11ì‹œ ì´í›„ì— 5íšŒ ì´ìƒ ì°¸ì—¬í•˜ì„¸ìš”.' },
            { id: 'b06', name: 'ë°©ì¥', icon: 'fa-flag', color: 'text-red-500', description: 'ìŠ¤í„°ë””ë°©ì„ 3íšŒ ì´ìƒ ê°œì„¤í•˜ì„¸ìš”.' },
        ];

        let rooms = [];
        let users = [
            { name: 'ë™ìš±', totalStudyTime: 250.5, avatar: 'https://placehold.co/40x40/FFC107/FFFFFF?text=D', acquiredBadges: ['b01', 'b02', 'b03', 'b05', 'b06'] },
            { name: 'ì§€ì€', totalStudyTime: 128.2, avatar: 'https://placehold.co/40x40/A3BFFA/FFFFFF?text=P', acquiredBadges: ['b01', 'b02'] },
            { name: 'ìœ ë¦¼', totalStudyTime: 195.8, avatar: 'https://placehold.co/40x40/4CAF50/FFFFFF?text=Y', acquiredBadges: ['b02', 'b03', 'b04'] },
            { name: 'ìˆ˜ì—°', totalStudyTime: 310.1, avatar: 'https://placehold.co/40x40/F44336/FFFFFF?text=S', acquiredBadges: ['b01', 'b02', 'b03', 'b04', 'b05', 'b06'] },
            { name: 'ë¯¼ì¤€', totalStudyTime: 95.3, avatar: 'https://placehold.co/40x40/9C27B0/FFFFFF?text=M', acquiredBadges: ['b02', 'b04'] },
        ];

        function initializeRooms() {
            rooms = [
                // UPDATED: 'ì§‘ì¤‘ ì¤‘' ìƒíƒœ ë°ì´í„° ì¶”ê°€
                { id: 1, title: 'ì•Œê³ ë¦¬ì¦˜ ì§‘ì¤‘ 50ë¶„ë°©', tags: ['ì½”ë”©í…ŒìŠ¤íŠ¸', 'ì•Œê³ ë¦¬ì¦˜'], members: 3, maxMembers: 6, isPrivate: false, password: null, focusTime: 50, restTime: 10, rules: { mic: true, cam: false, screen: true }, participants: ['ë™ìš±', 'ìˆ˜ì—°', 'ë¯¼ì¤€'], scheduledTime: null, timerState: 'running', isFocusSession: true, timerCurrentTime: 35 * 60 + 10 },
                { id: 2, title: 'ì•„íŠ¸ í¬íŠ¸í´ë¦¬ì˜¤ ì‘ì—…ë°©', tags: ['ì¼ëŸ¬ìŠ¤íŠ¸', 'í¬íŠ¸í´ë¦¬ì˜¤'], members: 4, maxMembers: 8, isPrivate: false, password: null, focusTime: 90, restTime: 15, rules: { mic: false, cam: false, screen: true }, participants: ['ìœ ë¦¼', 'í˜„ìš°', 'ë‹¤ì€', 'ì„œì¤€'], scheduledTime: null, timerState: 'stopped', isFocusSession: true, timerCurrentTime: 90 * 60 },
                { id: 3, title: 'FE í¬íŠ¸í´ë¦¬ì˜¤ ìŠ¤í„°ë”” (ê³ ì •)', tags: ['í”„ë¡ íŠ¸ì—”ë“œ', 'React'], members: 2, maxMembers: 4, isPrivate: true, password: '1234', focusTime: 25, restTime: 5, rules: { mic: true, cam: true, screen: true }, participants: ['ì§€í›ˆ', 'ì˜ˆì§„'], scheduledTime: null, timerState: 'stopped', isFocusSession: true, timerCurrentTime: 25 * 60 },
                { id: 4, title: 'ì €ë… ì½”ë”© ì±Œë¦°ì§€', tags: ['ì½”ë”©', 'ì±Œë¦°ì§€'], members: 1, maxMembers: 10, isPrivate: false, password: null, focusTime: 60, restTime: 10, rules: { mic: false, cam: false, screen: true }, participants: ['ì„ ì•„'], scheduledTime: '18:00', timerState: 'stopped', isFocusSession: true, timerCurrentTime: 60 * 60 },
                { id: 5, title: 'CS ìŠ¤í„°ë””', tags: ['CS', 'ë©´ì ‘ì¤€ë¹„'], members: 1, maxMembers: 5, isPrivate: false, password: null, focusTime: 45, restTime: 10, rules: { mic: true, cam: false, screen: false }, participants: ['ì¬ì„±'], scheduledTime: null, timerState: 'running', isFocusSession: true, timerCurrentTime: 15 * 60 + 30 },
                { id: 6, title: 'ë””ìì¸ ì‹œìŠ¤í…œ ìŠ¤í„°ë””', tags: ['ë””ìì¸', 'UI/UX'], members: 5, maxMembers: 5, isPrivate: false, password: null, focusTime: 50, restTime: 10, rules: { mic: true, cam: true, screen: true }, participants: ['í•˜ìœ¤', 'ë„í˜„', 'ì§€ì•„', 'ì‹œìš°', 'ì„œì•„'], scheduledTime: null, timerState: 'stopped', isFocusSession: true, timerCurrentTime: 50 * 60 },
            ];
        }

        let currentRoom = null;
        let previousPageId = 'lobby';
        
        // --- í˜ì´ì§€ ë Œë”ë§ í•¨ìˆ˜ ---
        function renderRooms() {
            const roomListEl = document.getElementById('roomList');
            if (!roomListEl) return;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const micFilter = document.getElementById('micFilter').checked;
            const camFilter = document.getElementById('camFilter').checked;
            const screenFilter = document.getElementById('screenFilter').checked;
            const filteredRooms = rooms.filter(r => {
                const titleMatch = r.title.toLowerCase().includes(searchTerm);
                const micMatch = !micFilter || r.rules.mic;
                const camMatch = !camFilter || r.rules.cam;
                const screenMatch = !screenFilter || r.rules.screen;
                return titleMatch && micMatch && camMatch && screenMatch;
            });
            roomListEl.innerHTML = '';
            if (filteredRooms.length === 0) {
                roomListEl.innerHTML = `<p class="text-gray-500 col-span-full text-center">ì¡°ê±´ì— ë§ëŠ” ìŠ¤í„°ë””ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }
            filteredRooms.forEach(room => {
                const isFull = room.members >= room.maxMembers;
                const rulesHtml = `<div class="flex items-center space-x-3 text-gray-500 mt-4"><span class="${room.rules.mic ? 'text-blue-600' : 'text-gray-300'}" title="ë§ˆì´í¬ í•„ìˆ˜"><i class="fas fa-microphone"></i></span><span class="${room.rules.cam ? 'text-blue-600' : 'text-gray-300'}" title="ìº  í•„ìˆ˜"><i class="fas fa-video"></i></span><span class="${room.rules.screen ? 'text-blue-600' : 'text-gray-300'}" title="í™”ë©´ê³µìœ  í•„ìˆ˜"><i class="fas fa-desktop"></i></span></div>`;
                let statusHtml = '';
                if (isFull) { statusHtml = `<span class="text-sm font-bold text-red-500">âŒ ì°¸ì—¬ ë¶ˆê°€</span>`; } 
                else if (room.scheduledTime) { statusHtml = `<span class="text-sm font-bold text-indigo-600"><i class="far fa-clock mr-1"></i> ì˜¤ëŠ˜ ${room.scheduledTime} ì‹œì‘ ì˜ˆì •</span>`; } 
                else if (room.timerState === 'running') { statusHtml = `<span class="text-sm font-bold text-orange-500">ğŸ”¥ ì§‘ì¤‘ ì¤‘</span>`; } 
                else { statusHtml = `<span class="text-sm font-bold text-green-500">âœ… ì°¸ì—¬ ê°€ëŠ¥</span>`; }
                const roomCard = `<div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-lg transition transform hover:-translate-y-1 flex flex-col justify-between relative ${isFull ? 'opacity-60 cursor-not-allowed' : 'cursor-pointer'}" onclick="${isFull ? '' : `openJoinModal(${room.id})`}">${isFull ? '<div class="absolute inset-0 bg-gray-100 bg-opacity-50 rounded-xl"></div>' : ''}<div><div class="flex justify-between items-start mb-2"><h3 class="text-xl font-bold flex items-center">${room.title} ${room.isPrivate ? '<i class="fas fa-lock text-gray-400 text-sm ml-2"></i>' : ''}</h3><span class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">${room.members}/${room.maxMembers}</span></div><div class="mb-4">${statusHtml}</div><div class="flex flex-wrap gap-2 mb-4">${room.tags.map(tag => `<span class="bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded-md">#${tag}</span>`).join('')}</div></div><div class="flex justify-between items-center mt-2">${rulesHtml}<div class="text-right text-blue-600 font-semibold">${isFull ? '' : 'ì°¸ì—¬í•˜ê¸° <i class="fas fa-arrow-right"></i>'}</div></div></div>`;
                roomListEl.innerHTML += roomCard;
            });
        }

        function renderStudyRoom(roomId) {
            currentRoom = rooms.find(r => r.id === roomId);
            if (!currentRoom) return;
            const studyRoomEl = document.getElementById('studyRoom');
            studyRoomEl.innerHTML = `<div class="flex justify-between items-center mb-4"><h2 class="text-3xl font-bold">${currentRoom.title}</h2><button class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600" onclick="leaveRoom()">ë‚˜ê°€ê¸°</button></div><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 bg-gray-900 rounded-xl p-4 grid grid-cols-2 gap-4">${Array(currentRoom.members).fill(0).map((_, i) => `<div class="bg-black rounded-lg relative aspect-video overflow-hidden"><img src="${mockScreenImages[i % mockScreenImages.length]}" alt="Shared Screen ${i+1}" class="w-full h-full object-cover"><div class="absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-sm px-2 py-1 rounded">${i === 0 ? 'ì§€ì€ (ë‚˜)' : currentRoom.participants[i] || `ì°¸ê°€ì ${i + 1}`}</div></div>`).join('')}${Array(currentRoom.maxMembers - currentRoom.members).fill(0).map((_, i) => `<div class="bg-gray-800 border-2 border-dashed border-gray-600 rounded-lg aspect-video flex items-center justify-center"><span class="text-gray-500">ë¹ˆ ìë¦¬</span></div>`).join('')}</div><div class="bg-white rounded-xl shadow-sm p-6 flex flex-col space-y-6"><div class="text-center border-b pb-6"><h3 id="timerTitle" class="font-bold text-lg mb-2"></h3><div id="timerDisplay" class="text-6xl font-bold text-blue-600 mb-4"></div><div class="flex justify-center space-x-2"><button id="timerBtn" class="w-24 py-2 rounded-lg" onclick="toggleTimer()"></button><button class="bg-gray-500 text-white w-24 py-2 rounded-lg hover:bg-gray-600" onclick="resetTimer()"><i class="fas fa-redo"></i> ì´ˆê¸°í™”</button></div></div><div class="flex-grow flex flex-col h-64"><h3 class="font-bold text-lg mb-2">ì±„íŒ…</h3><div id="chatBox" class="flex-grow bg-gray-100 rounded-lg p-3 overflow-y-auto mb-2"><div class="text-sm text-gray-500">ë°©ì— ì…ì¥í–ˆìŠµë‹ˆë‹¤.</div></div><div class="flex"><input id="chatInput" type="text" class="flex-grow border p-2 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="ë©”ì‹œì§€ ì…ë ¥..."><button class="bg-blue-600 text-white px-4 rounded-r-lg hover:bg-blue-700" onclick="sendChatMessage()">ì „ì†¡</button></div></div></div></div>`;
            updateTimerUI();
            showPage('studyRoom');
        }

        function renderMyPage() {
            const myPageEl = document.getElementById('myPage');
            const currentUser = users.find(u => u.name === 'ì§€ì€');
            const badgesHtml = allBadges.map(badge => {
                const isAcquired = currentUser.acquiredBadges.includes(badge.id);
                return `<i class="fas ${badge.icon} ${isAcquired ? badge.color : 'text-gray-300'} fa-2x" title="${badge.name} - ${badge.description}"></i>`;
            }).join('');

            myPageEl.innerHTML = `<div class="bg-white p-8 rounded-xl shadow-sm"><div class="flex items-center space-x-4 mb-8"><img src="${currentUser.avatar}" alt="User" class="w-24 h-24 rounded-full border-4 border-blue-200"><div><h2 class="text-3xl font-bold">${currentUser.name} ë‹˜</h2><p class="text-gray-500">ì½”ë”© í…ŒìŠ¤íŠ¸ ì¤€ë¹„, ì•Œê³ ë¦¬ì¦˜ ì‹¤ë ¥ í–¥ìƒ</p></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center mb-10"><div class="bg-gray-100 p-6 rounded-lg"><p class="text-gray-500 text-sm">ì´ ê³µë¶€ ì‹œê°„</p><p class="text-3xl font-bold text-blue-600">${currentUser.totalStudyTime.toFixed(1)} <span class="text-lg font-medium">ì‹œê°„</span></p></div><div class="bg-gray-100 p-6 rounded-lg"><p class="text-gray-500 text-sm">ì™„ë£Œí•œ ëª©í‘œ</p><p class="text-3xl font-bold text-green-600">72 <span class="text-lg font-medium">ê°œ</span></p></div><div class="bg-gray-100 p-6 rounded-lg"><p class="text-gray-500 text-sm">íšë“ ë±ƒì§€</p><p class="text-3xl font-bold">${currentUser.acquiredBadges.length} <span class="text-lg font-medium">ê°œ</span></p></div></div><div><h3 class="text-xl font-bold mb-4">ë‚˜ì˜ ë±ƒì§€ í˜„í™©</h3><div class="p-4 bg-gray-50 rounded-lg flex justify-around items-center">${badgesHtml}</div></div><div class="mt-8"><h3 class="text-xl font-bold mb-4">ìµœê·¼ í™œë™ ê¸°ë¡</h3><ul class="space-y-3"><li class="bg-white p-4 rounded-lg border flex justify-between items-center"><div><p class="font-semibold">ì•Œê³ ë¦¬ì¦˜ ì§‘ì¤‘ 50ë¶„ë°©</p><p class="text-sm text-gray-500">ëª©í‘œ: ë°±ì¤€ ê³¨ë“œ ë¬¸ì œ 2ê°œ í’€ì´</p></div><span class="text-sm text-gray-400">ì–´ì œ</span></li><li class="bg-white p-4 rounded-lg border flex justify-between items-center"><div><p class="font-semibold">ì•„íŠ¸ í¬íŠ¸í´ë¦¬ì˜¤ ì§‘ì¤‘ë°©</p><p class="text-sm text-gray-500">ëª©í‘œ: ìºë¦­í„° 3ì»· ì™„ì„±</p></div><span class="text-sm text-gray-400">3ì¼ ì „</span></li></ul></div></div>`;
        }
        
        function renderRankingPage() {
            const rankingPageEl = document.getElementById('rankingPage');
            const sortedUsers = [...users].sort((a, b) => b.totalStudyTime - a.totalStudyTime);
            const rankingListHtml = sortedUsers.map((user, index) => {
                const rank = index + 1;
                let rankIcon = '';
                if (rank === 1) rankIcon = '<i class="fas fa-crown text-yellow-400"></i>';
                else if (rank === 2) rankIcon = '<i class="fas fa-medal text-gray-400"></i>';
                else if (rank === 3) rankIcon = '<i class="fas fa-medal text-orange-400"></i>';
                else rankIcon = `<span class="font-bold text-gray-500">${rank}</span>`;
                return `<div class="flex items-center bg-gray-50 p-4 rounded-lg hover:bg-gray-100 transition cursor-pointer" onclick="showUserProfile('${user.name}')"><div class="w-12 text-center text-xl">${rankIcon}</div><img src="${user.avatar}" alt="${user.name}" class="w-12 h-12 rounded-full mx-4"><p class="flex-grow font-bold text-lg text-gray-800">${user.name}</p><p class="text-blue-600 font-bold text-lg">${user.totalStudyTime.toFixed(1)} ì‹œê°„</p></div>`;
            }).join('');
            rankingPageEl.innerHTML = `<div class="bg-white p-8 rounded-xl shadow-sm"><h2 class="text-3xl font-bold mb-2">ğŸ† ê³µë¶€ ì‹œê°„ ë­í‚¹</h2><p class="text-gray-500 mb-8">ê¾¸ì¤€í•¨ì´ ìµœê³ ì˜ ë¬´ê¸°! ë‹¤ë¥¸ ë¶„ë“¤ê³¼ í•¨ê»˜ ì„±ì¥í•´ë³´ì„¸ìš”.</p><div class="space-y-3">${rankingListHtml}</div></div>`;
        }
        
        function renderUserProfile(userName) {
            const profilePageEl = document.getElementById('userProfilePage');
            const user = users.find(u => u.name === userName);
            if (!user) return;
            const badgesHtml = user.acquiredBadges.map(badgeId => {
                const badge = allBadges.find(b => b.id === badgeId);
                return `<div class="text-center" title="${badge.name} - ${badge.description}"><i class="fas ${badge.icon} ${badge.color} fa-2x mb-1"></i><p class="text-xs font-medium">${badge.name}</p></div>`;
            }).join('');

            profilePageEl.innerHTML = `
                <div class="bg-white p-8 rounded-xl shadow-sm">
                    <button onclick="showPage(previousPageId)" class="mb-6 text-blue-600 hover:underline"><i class="fas fa-arrow-left mr-2"></i>ë’¤ë¡œ ê°€ê¸°</button>
                    <div class="flex flex-col items-center text-center">
                        <img src="${user.avatar}" alt="${user.name}" class="w-32 h-32 rounded-full border-4 border-blue-300 mb-4">
                        <h2 class="text-4xl font-bold">${user.name}</h2>
                        <p class="text-lg text-gray-500 mt-2">ì´ ê³µë¶€ ì‹œê°„: <span class="font-bold text-blue-600">${user.totalStudyTime.toFixed(1)}</span> ì‹œê°„</p>
                    </div>
                    <div class="mt-10">
                        <h3 class="text-xl font-bold mb-4 text-center">íšë“í•œ ë±ƒì§€ (${user.acquiredBadges.length}ê°œ)</h3>
                        <div class="p-6 bg-gray-50 rounded-lg grid grid-cols-3 md:grid-cols-6 gap-4">
                            ${badgesHtml || '<p class="col-span-full text-center text-gray-500">ì•„ì§ íšë“í•œ ë±ƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}
                        </div>
                    </div>
                </div>`;
        }

        function renderCreateRoomModal() {
            const modalEl = document.getElementById('createRoomModal');
            modalEl.innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md m-4"><h2 class="text-2xl font-bold mb-6">ìŠ¤í„°ë””ë°© ë§Œë“¤ê¸°</h2><div class="space-y-4"><input id="newRoomTitleInput" type="text" placeholder="ë°© ì œëª©" class="w-full p-3 border rounded-lg"><input id="newRoomTagsInput" type="text" placeholder="íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„. ì˜ˆ: React,ì•Œê³ ë¦¬ì¦˜)" class="w-full p-3 border rounded-lg"><select id="newRoomTypeInput" class="w-full p-3 border rounded-lg"><option value="public">ê³µê°œë°©</option><option value="private">ë¹„ê³µê°œë°©</option></select><input id="newRoomPasswordInput" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (ë¹„ê³µê°œë°© ì„ íƒ ì‹œ)" class="w-full p-3 border rounded-lg hidden"><div><label class="block text-sm font-medium text-gray-700 mb-2">ë½€ëª¨ë„ë¡œ ì„¤ì •</label><div class="flex space-x-2"><input id="newFocusTimeInput" type="number" value="25" class="w-full p-3 border rounded-lg" title="ì§‘ì¤‘ ì‹œê°„(ë¶„)"><input id="newRestTimeInput" type="number" value="5" class="w-full p-3 border rounded-lg" title="íœ´ì‹ ì‹œê°„(ë¶„)"></div></div><div><label class="block text-sm font-medium text-gray-700 mb-2">í•„ìˆ˜ ê·œì¹™ ì„¤ì •</label><div class="space-y-3"><div class="flex items-center justify-between bg-gray-100 p-3 rounded-lg"><span class="font-medium"><i class="fas fa-microphone mr-2"></i>ë§ˆì´í¬ ON</span><label class="switch"><input id="newMicRequired" type="checkbox"><span class="slider"></span></label></div><div class="flex items-center justify-between bg-gray-100 p-3 rounded-lg"><span class="font-medium"><i class="fas fa-video mr-2"></i>ìº  ON</span><label class="switch"><input id="newCamRequired" type="checkbox"><span class="slider"></span></label></div><div class="flex items-center justify-between bg-gray-100 p-3 rounded-lg"><span class="font-medium"><i class="fas fa-desktop mr-2"></i>í™”ë©´ ê³µìœ </span><label class="switch"><input id="newScreenRequired" type="checkbox"><span class="slider"></span></label></div></div></div></div><div class="mt-8 flex justify-end space-x-3"><button class="bg-gray-200 px-6 py-2 rounded-lg hover:bg-gray-300" onclick="closeCreateRoomModal()">ì·¨ì†Œ</button><button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700" onclick="createRoom()">ìƒì„±í•˜ê¸°</button></div></div>`;
            document.getElementById('newRoomTypeInput').addEventListener('change', (e) => {
                document.getElementById('newRoomPasswordInput').classList.toggle('hidden', e.target.value !== 'private');
            });
        }

        function renderJoinRoomModal() {
            const modalEl = document.getElementById('joinRoomModal');
            modalEl.innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md m-4 relative"><button onclick="closeJoinModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button><h2 class="text-2xl font-bold mb-2">ìŠ¤í„°ë””ë°© ì…ì¥</h2><p id="joinRoomTitle" class="text-gray-600 mb-4"></p><div class="space-y-4 mb-6"><div id="joinRoomParticipants" class="p-4 bg-gray-50 rounded-lg"><h4 class="font-bold text-gray-800 mb-2">í˜„ì¬ ì°¸ì—¬ì</h4><div class="flex flex-wrap gap-2"></div></div><div id="joinRoomTimerStatus" class="p-4 bg-gray-50 rounded-lg"><h4 class="font-bold text-gray-800 mb-2">íƒ€ì´ë¨¸ ìƒíƒœ</h4><p class="text-gray-600"></p></div><div id="joinRoomRules" class="p-4 bg-gray-50 rounded-lg"><h4 class="font-bold text-gray-800 mb-2">ì…ì¥ ê·œì¹™</h4><div class="flex items-center space-x-4 text-gray-700"></div></div><div id="passwordSection" class="hidden"><label for="joinPasswordInput" class="block text-sm font-medium text-gray-700 mb-1">ë¹„ë°€ë²ˆí˜¸</label><input id="joinPasswordInput" type="password" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"></div></div><input id="goalInput" type="text" placeholder="ì˜¤ëŠ˜ì˜ ëª©í‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”!" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"><div class="mt-8 flex justify-end"><button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700" onclick="joinRoom()">ì…ì¥í•˜ê¸°</button></div></div>`;
        }

        // --- í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ---
        function showPage(pageId) {
            const currentPageEl = document.querySelector('.page.active');
            if (currentPageEl) {
                previousPageId = currentPageEl.id;
            }
            if (pageId === 'lobby') { currentRoom = null; } 
            else if (pageId === 'rankingPage') { renderRankingPage(); } 
            else if (pageId === 'myPage') { renderMyPage(); }
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
        }

        function showUserProfile(userName) {
            renderUserProfile(userName);
            showPage('userProfilePage');
        }
        
        function toggleMobileMenu() { document.getElementById('mobileMenu').classList.toggle('hidden'); }

        // --- ëª¨ë‹¬ ê´€ë¦¬ ---
        function openCreateRoomModal() { document.getElementById('createRoomModal').classList.remove('hidden'); }
        function closeCreateRoomModal() { document.getElementById('createRoomModal').classList.add('hidden'); }
        
        function openJoinModal(roomId) {
            const room = rooms.find(r => r.id === roomId);
            if (room) {
                document.getElementById('joinRoomTitle').textContent = `"${room.title}" ë°©ì— ì…ì¥í•©ë‹ˆë‹¤.`;
                const participantsEl = document.getElementById('joinRoomParticipants').querySelector('div');
                participantsEl.innerHTML = room.participants.map(p => `<span class="bg-gray-200 px-2 py-1 rounded-full text-sm font-medium text-gray-700">${p}</span>`).join('') || `<p class="text-sm text-gray-500">ì•„ì§ ì°¸ì—¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
                const timerStatusEl = document.getElementById('joinRoomTimerStatus').querySelector('p');
                if (room.timerState === 'running') {
                    const minutes = Math.floor(room.timerCurrentTime / 60);
                    const seconds = room.timerCurrentTime % 60;
                    timerStatusEl.innerHTML = `<span class="font-bold ${room.isFocusSession ? 'text-red-500' : 'text-green-500'}">${room.isFocusSession ? 'ì§‘ì¤‘' : 'íœ´ì‹'} ì‹œê°„</span> ì§„í–‰ ì¤‘ (${minutes}:${String(seconds).padStart(2, '0')} ë‚¨ìŒ)`;
                } else { timerStatusEl.textContent = 'íƒ€ì´ë¨¸ ëŒ€ê¸° ì¤‘'; }
                const rulesEl = document.getElementById('joinRoomRules').querySelector('div');
                rulesEl.innerHTML = `<span class="${room.rules.mic ? 'text-blue-600' : 'text-gray-400'}" title="ë§ˆì´í¬"><i class="fas fa-microphone fa-lg mr-1"></i> ${room.rules.mic ? 'í•„ìˆ˜' : 'ì„ íƒ'}</span><span class="${room.rules.cam ? 'text-blue-600' : 'text-gray-400'}" title="ìº "><i class="fas fa-video fa-lg mr-1"></i> ${room.rules.cam ? 'í•„ìˆ˜' : 'ì„ íƒ'}</span><span class="${room.rules.screen ? 'text-blue-600' : 'text-gray-400'}" title="í™”ë©´ê³µìœ "><i class="fas fa-desktop fa-lg mr-1"></i> ${room.rules.screen ? 'í•„ìˆ˜' : 'ì„ íƒ'}</span>`;
                const passwordSection = document.getElementById('passwordSection');
                passwordSection.classList.toggle('hidden', !room.isPrivate);
                document.getElementById('joinRoomModal').dataset.roomId = roomId;
                document.getElementById('joinRoomModal').classList.remove('hidden');
            }
        }
        function closeJoinModal() { document.getElementById('joinRoomModal').classList.add('hidden'); }
        
        // --- ìŠ¤í„°ë””ë°© ë¡œì§ ---
        function createRoom() {
            const focusTime = parseInt(document.getElementById('newFocusTimeInput').value) || 25;
            const isPrivate = document.getElementById('newRoomTypeInput').value === 'private';
            const password = isPrivate ? document.getElementById('newRoomPasswordInput').value : null;
            if (isPrivate && !password) { alert('ë¹„ê³µê°œë°©ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.'); return; }
            const tagInput = document.getElementById('newRoomTagsInput').value;
            const tags = tagInput.split(',').map(tag => tag.trim()).filter(tag => tag);

            const newRoom = { id: rooms.length + 1, title: document.getElementById('newRoomTitleInput').value || 'ìƒˆë¡œìš´ ìŠ¤í„°ë””ë°©', tags: tags, members: 1, maxMembers: 6, isPrivate, password, focusTime: focusTime, restTime: parseInt(document.getElementById('newRestTimeInput').value) || 5, rules: { mic: document.getElementById('newMicRequired').checked, cam: document.getElementById('newCamRequired').checked, screen: document.getElementById('newScreenRequired').checked, }, participants: ['ì§€ì€'], scheduledTime: null, timerState: 'stopped', isFocusSession: true, timerCurrentTime: focusTime * 60, };
            rooms.push(newRoom);
            closeCreateRoomModal();
            renderStudyRoom(newRoom.id);
        }

        function joinRoom() {
            const goal = document.getElementById('goalInput').value;
            if (!goal) { alert('ì˜¤ëŠ˜ì˜ ëª©í‘œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
            const roomId = parseInt(document.getElementById('joinRoomModal').dataset.roomId);
            const room = rooms.find(r => r.id === roomId);
            if (room.isPrivate) {
                const enteredPassword = document.getElementById('joinPasswordInput').value;
                if (enteredPassword !== room.password) { alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
            }
            if (room.members < room.maxMembers) {
                room.members++;
                room.participants.push('ì§€ì€(ë‚˜)');
                closeJoinModal();
                renderStudyRoom(roomId);
            } else { alert('ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.'); closeJoinModal(); }
        }

        function leaveRoom() { if (currentRoom) { const room = rooms.find(r => r.id === currentRoom.id); if (room) { room.members--; const myIndex = room.participants.indexOf('ì§€ì€(ë‚˜)'); if (myIndex > -1) { room.participants.splice(myIndex, 1); } } currentRoom = null; renderRooms(); showPage('lobby'); } }
        function sendChatMessage() { const chatInput = document.getElementById('chatInput'); const chatBox = document.getElementById('chatBox'); if (chatInput && chatInput.value.trim() !== '') { const msgEl = document.createElement('div'); msgEl.innerHTML = `<span class="font-bold text-blue-700">ë‚˜:</span> ${chatInput.value}`; msgEl.className = 'text-sm mb-1'; chatBox.appendChild(msgEl); chatInput.value = ''; chatBox.scrollTop = chatBox.scrollHeight; } }
        function toggleTimer() { if (!currentRoom) return; if (currentRoom.timerState === 'running') { currentRoom.timerState = 'paused'; } else { currentRoom.timerState = 'running'; } updateTimerUI(); }
        function resetTimer() { if (!currentRoom) return; currentRoom.timerState = 'stopped'; currentRoom.isFocusSession = true; currentRoom.timerCurrentTime = currentRoom.focusTime * 60; updateTimerUI(); }
        function updateTimerUI() { if (!currentRoom || !document.getElementById('studyRoom').classList.contains('active')) return; const timerTitleEl = document.getElementById('timerTitle'); const timerDisplayEl = document.getElementById('timerDisplay'); const timerBtnEl = document.getElementById('timerBtn'); if (!timerTitleEl || !timerDisplayEl || !timerBtnEl) return; timerTitleEl.textContent = currentRoom.isFocusSession ? 'ğŸ”¥ ì§‘ì¤‘ ì‹œê°„' : 'â˜•ï¸ íœ´ì‹ ì‹œê°„'; timerTitleEl.className = `font-bold text-lg mb-2 ${currentRoom.isFocusSession ? 'text-red-500' : 'text-green-500'}`; const minutes = Math.floor(currentRoom.timerCurrentTime / 60); const seconds = currentRoom.timerCurrentTime % 60; timerDisplayEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`; if (currentRoom.timerState === 'running') { timerBtnEl.innerHTML = '<i class="fas fa-pause"></i> ì¼ì‹œì •ì§€'; timerBtnEl.className = 'w-24 py-2 rounded-lg bg-yellow-500 text-white hover:bg-yellow-600'; } else { timerBtnEl.innerHTML = '<i class="fas fa-play"></i> ì‹œì‘'; timerBtnEl.className = 'w-24 py-2 rounded-lg bg-green-500 text-white hover:bg-green-600'; } }
        
        // ì „ì—­ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ ë£¨í”„
        setInterval(() => {
            rooms.forEach(room => {
                if (room.timerState === 'running') {
                    if (room.timerCurrentTime > 0) { room.timerCurrentTime--; } 
                    else {
                        room.isFocusSession = !room.isFocusSession;
                        room.timerCurrentTime = (room.isFocusSession ? room.focusTime : room.restTime) * 60;
                        room.timerState = 'stopped';
                        if (currentRoom && currentRoom.id === room.id) { alert(room.isFocusSession ? 'íœ´ì‹ ë! ìƒˆë¡œìš´ ì§‘ì¤‘ ì‹œê°„ì…ë‹ˆë‹¤.' : 'ì§‘ì¤‘ ì‹œê°„ ë! íœ´ì‹ ì‹œê°„ì…ë‹ˆë‹¤.'); }
                    }
                }
            });
            if (currentRoom) { updateTimerUI(); }
            if (document.getElementById('lobby').classList.contains('active')) { renderRooms(); }
        }, 1000);
        
        // --- ì´ˆê¸°í™” ---
        window.onload = () => {
            initializeRooms();
            renderMyPage();
            renderCreateRoomModal();
            renderJoinRoomModal();
            renderRooms();
            document.getElementById('searchInput').addEventListener('keyup', renderRooms);
            document.getElementById('micFilter').addEventListener('change', renderRooms);
            document.getElementById('camFilter').addEventListener('change', renderRooms);
            document.getElementById('screenFilter').addEventListener('change', renderRooms);
        };
    </script>
</body>
</html>
